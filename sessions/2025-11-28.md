# 2025-11-28 Project Session

## Session Summary

Implemented major improvements inspired by Anthropic's "Effective harnesses for long-running agents" blog post. Version bumped to 0.11.0.

### Key Changes Implemented

1. **Session Continuity System (PROGRESS.md)**
   - Created `ProgressManager` class (`src/orchestrator/core/progress.py`)
   - Tracks task completions/failures with timestamps, summaries, and changed files
   - Actors read recent progress at session start for orientation
   - Integrated into orchestrator and planner

2. **Structured Feature Tracking (features.json)**
   - Created `FeaturesManager` class (`src/orchestrator/core/features.py`)
   - JSON-based feature list with `passes: boolean` fields
   - Auto-syncs with GOALS.md
   - Strong protection against actors modifying feature definitions

3. **"Get Bearings" Protocol for Actors**
   - Updated `build_task_agent_prompt()` in `context.py`
   - STEP 1: Check git status, read git log, review progress
   - Git status and recent commits now included in workspace context

4. **"Leave Clean State" Protocol**
   - STEP 3 in actor prompt: commit changes, no half-implemented code
   - Emphasis on leaving environment merge-ready

5. **Strengthened Acceptance Criteria**
   - Added "IT IS UNACCEPTABLE TO REMOVE, MODIFY, OR SKIP" warning
   - Actors explicitly forbidden from changing verification checks

6. **Domain-Aware Testing Hooks**
   - Added `web_app` domain detection for full-stack projects
   - Browser automation guidance (Puppeteer/Playwright) for web apps
   - Testing recommendations per domain type

7. **init.sh Creation in Interview**
   - Interview now asks about dev environment setup
   - Creates init.sh for reproducible environment initialization

### Files Changed
- `src/orchestrator/core/progress.py` (new)
- `src/orchestrator/core/features.py` (new)
- `src/orchestrator/core/context.py` (major updates)
- `src/orchestrator/core/contracts.py` (added progress/git fields to PlanContext)
- `src/orchestrator/core/planner.py` (integrated progress tracking)
- `src/orchestrator/core/orchestrator.py` (integrated progress + features managers)
- `src/orchestrator/core/domain_context.py` (added web_app domain + testing recommendations)
- `src/orchestrator/cli/__init__.py` (interview creates init.sh)
- `src/orchestrator/planning/goals.py` (added save() method)
- `src/orchestrator/__init__.py` (version 0.11.0)
- `pyproject.toml` (version 0.11.0)
- `CHANGELOG.md` (added 0.11.0 entry)

## Next Session

- **Test with new example-project**: Run `orchestrate interview` and `orchestrate run` on a fresh project to verify:
  - PROGRESS.md is created and updated
  - features.json is synced with GOALS.md
  - Actors follow "get bearings" protocol
  - init.sh is created during interview
  - Web app domain detection triggers browser automation guidance
- **Monitor**: Check if actors actually commit their work as instructed
- **Consider**: Whether features.json should be read-only (file permissions) to truly prevent modification
- **Potential improvement**: Add pre-task sanity check that runs basic tests before starting new work (not just prompt instructions)
